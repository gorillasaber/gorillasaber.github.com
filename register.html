<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title data-i18n="site_title_register">Gorilla Saber ü¶ç - Register</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/snow.js" defer></script>
  <script type="module">  
  import { startDiscordLogin } from "/js/login.js";
  document.getElementById("discordLoginBtn").addEventListener("click", startDiscordLogin);
  </script>
</head>
<body>
<canvas id="snowfall-element"></canvas>
<header>
  <h1 data-i18n="site_title">Gorilla Saber ü¶ç</h1>
  <nav>
    <a href="index.html" data-i18n="nav_home">Home</a>
    <a href="spp.html" data-i18n="nav_spp">SPP Bot</a>
    <a href="leaderboard.html" data-i18n="nav_leaderboard">Global Ranking</a>
    <a href="ranked.html" data-i18n="nav_ranked">Ranked Maps</a>
    <a href="register.html" data-i18n="nav_register">Register</a>
  </nav>
  <div id="langSwitch">
    <button data-lang="en">EN</button>
    <button data-lang="ua">UA</button>
  </div>
</header>

<main>
  <section id="register">
    <h2 data-i18n="reg_title">Register Gorilla Saber account</h2>
    <p data-i18n="reg_hint">
      Fill the form. The site will calculate your SPP and generate a JSON entry for players.json.
    </p>

    <form id="registerForm">
      <label for="regName" data-i18n="reg_label_name">Nickname:</label>
      <input type="text" id="regName" required>

      <label for="regCountry" data-i18n="reg_label_country">Country (e.g. UA, PL, US):</label>
      <input type="text" id="regCountry" maxlength="3" required>

      <label for="regBlUrl" data-i18n="reg_label_bl">BeatLeader profile URL:</label>
      <input type="url" id="regBlUrl" placeholder="https://beatleader.com/u/vanvani41off" required>

      <label for="regSsUrl" data-i18n="reg_label_ss">ScoreSaber profile URL:</label>
      <input type="url" id="regSsUrl" placeholder="https://scoresaber.com/u/76561199210804681" required>

      <button type="submit" data-i18n="reg_button">Register on GorillaSaber!</button>
    </form>
    <hr><small data-i18b="reg_or">or</small><hr>
    <div id="authBox">
  <a id="discordLoginBtn" href="#">–£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Discord</a>
  <button id="logoutBtn" style="display:none;">–í–∏–π—Ç–∏</button>
  <div id="meBox" style="margin-top:10px;"></div>
</div>
<script>
  const DISCORD_OAUTH_URL = "https://discord.com/oauth2/authorize?client_id=1455325991449657556&response_type=code&redirect_uri=https%3A%2F%2Fgorillasaber.github.io%2Fauth%2Fdiscord%2Fcallback&scope=identify+email";

  const loginBtn = document.getElementById("discordLoginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const meBox = document.getElementById("meBox");

  function render() {
    const meRaw = localStorage.getItem("discord_me");
    if (!meRaw) {
      loginBtn.style.display = "";
      logoutBtn.style.display = "none";
      meBox.textContent = "–ù–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π";
      loginBtn.href = DISCORD_OAUTH_URL;
      return;
    }

    const me = JSON.parse(meRaw);
    loginBtn.style.display = "none";
    logoutBtn.style.display = "";
    meBox.textContent = `–ó–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π —è–∫: ${me.username}#${me.discriminator} (id: ${me.id})`;
  }

  logoutBtn.addEventListener("click", () => {
    localStorage.removeItem("discord_me");
    localStorage.removeItem("discord_token");
    render();
  });

  render();
</script>
    <div id="regStatus" style="margin-top:10px;"></div>

    <div id="regResult" class="card" style="margin-top:12px; display:none;">
      <h3 data-i18n="reg_result_title">Your players.json entry</h3>
      <p data-i18n="reg_copy_info">
        Copy this object into data/players.json (or send it to the admin).
      </p>
      <textarea id="regOutput" readonly
        style="width:100%; height:140px; margin-top:8px; background:#111;
               color:#eee; border:1px solid #333; border-radius:4px;"></textarea>
    </div>
  </section>
</main>

<footer>
  <small data-i18n="footer_text">Gorilla Saber is a fan project ‚Ä¢ 2026 ‚Ä¢ All rights is not reserved(</small>
</footer>

<script src="js/app.js"></script>
</body>
</html>
